<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>User Manage Page</title>
    <link href="http://unpkg.com/view-design/dist/styles/iview.css" rel="stylesheet" type="text/css">
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script src="http://unpkg.com/view-design/dist/iview.min.js" type="text/javascript"></script>
</head>

<body>
<div id="app">
    <div class="layout" style="width: 1200px; margin: 0 auto;">
        <Layout>
            <header>
                <row>
                    <Divider orientation="left">
                        <h1>员工信息</h1>
                    </Divider>
                </row>
                <row justify="end" type="flex">
                    <i-col style="margin-right: 5px">
                        <i-button @click="create" icon="md-add" type="primary">添加</i-button>
                    </i-col>
                    <i-col style="margin-right: 5px">
                        <i-button @click="setUp = true" icon="md-settings" type="success">设置</i-button>
                    </i-col>
                </row>
            </header>

            <Content>
                <i-table :border="showBorder" :columns="tableColumns1" :data="data2" :height="fixedHeader ? 250 : ''" :showHeader="showHeader" :size="tableSize" :stripe="showStripe">
                    <template slot="name" slot-scope="{ row }">
                        <strong>{{ row.name }}</strong>
                    </template>
                    <template slot="action" slot-scope="{ row, index }">
                        <i-button @click="show(index)" icon="ios-create-outline" size="small" style="margin-right: 5px" type="primary">编辑</i-button>
                        <i-button @click="remove(index)" icon="ios-trash" size="small" type="error">删除</i-button>
                    </template>
                </i-table>

                <div style="margin: 10px;overflow: hidden">
                    <div style="float: right;">
                        <Page :current="currentPage" :pageSize="pageSize" :total="data1.length" @on-change="changePage" @on-page-size-change="changePageSize" show-elevator show-sizer show-total></Page>
                    </div>
                </div>
            </Content>
        </Layout>

        <Drawer :closable="true" :mask="false" title="Set up" v-model="setUp">
            <div style="margin: 10px">
                Table Setting<br>
                <i-switch style="margin-right: 5px" v-model="showBorder"></i-switch>Display border<br>
                <i-switch style="margin-right: 5px" v-model="showStripe"></i-switch>Display stripe<br>
                <i-switch style="margin-right: 5px" v-model="showIndex"></i-switch>Display index<br>
                <i-switch style="margin-right: 5px" v-model="showCheckbox"></i-switch>Display multi choice<br>
                <i-switch style="margin-right: 5px" v-model="showHeader"></i-switch>Display header<br>
                <i-switch style="margin-right: 5px" v-model="fixedHeader"></i-switch>Display scrolling<br>
                <br><br>

                Table size
                <i-select style="width: 200px" v-model="tableSize">
                    <i-option value="large">large</i-option>
                    <i-option value="default">default</i-option>
                    <i-option value="small">small</i-option>
                </i-select>
            </div>
        </Drawer>

        <Modal @on-cancel="cancelEditor" @on-ok="okEditor" title="Emp Info" v-model="empModal">
            <i-form :label-width="80">
                <form-item label="Uid:">
                    <i-input placeholder="学号..." style="width: 300px" v-model="empInfo.uid" />
                </form-item>
                <form-item label="Name:">
                    <i-input placeholder="姓名..." style="width: 300px" v-model="empInfo.name" />
                </form-item>
                <form-item label="Email:">
                    <i-input placeholder="邮箱..." style="width: 300px" v-model="empInfo.email" />
                </form-item>
                <form-item label="DeptName:">
                    <i-select v-model="empInfo.deptName">
                        <i-option :key="index" :value="item.deptName" v-for="(item, index) in dept">{{item.deptName}}</i-option>
                    </i-select>
                </form-item>
            </i-form>
        </Modal>
    </div>

</div>


<script>
    let app = new Vue({
        el: '#app',
        data() {
            return {
                createOrEditor:false,
                empModal:false,
                empInfo:{
                    uid:'',
                    name:'',
                    email:'',
                    deptName:''
                },
                setUp:false,
                currentPage:1,
                pageSize:10,
                tableColumns1: [{
                    type: 'index2',
                    width: 80,
                    align: 'center',
                    //well, please change the setting of language from  ECMA 5.1 to  ECMA 6.0
                    render: (h, params) => {
                        return h('span',params.index + (this.currentPage - 1) * this.pageSize + 1);
                    }
                },
                    {
                        title: '学号',
                        key: 'uid',
                        sortable:true
                    },
                    {
                        title: 'Name',
                        slot: 'name'
                    },
                    {
                        title: '邮箱',
                        key: 'email'
                    },
                    {
                        title: '年级',
                        key: 'deptName'
                    },
                    {
                        title: 'Action',
                        slot: 'action',
                        width: 200,
                        align: 'center'
                    }
                ],
                dept: [{
                    deptId: '1',
                    deptName: '初一级部'
                },{
                    deptId: '2',
                    deptName: '初二级部'
                },{
                    deptId: '3',
                    deptName: '初三级部'
                }],

                data1:[{
                        uid: '1001',
                        name: 'Nagisa',
                        email: 'Nagisa@Tkoyo.com',
                        deptId: '1',
                        deptName: '初一级部'
                    },
                    {
                        uid: '1002',
                        name: 'Madoka',
                        email: 'Madoka@Xuold.per',
                        deptId: '2',
                        deptName: '初一级部'
                    },
                    {
                        uid: '1003',
                        name: 'Pain',
                        email: 'PainSix@naruto.mov',
                        deptId: '3',
                        deptName: '初三级部'
                    },
                    {
                        uid: '1004',
                        name: 'Yuki',
                        email: 'Yuki@depress.mkv',
                        deptId: '2',
                        deptName: '初二级部'
                    }],

                data2:[],
                showBorder:false,
                showStripe:false,
                showHeader:true,
                showIndex:true,
                showCheckbox:false,
                fixedHeader:false,
                tableSize: 'default'
            }
        },
        methods: {
            changePage(index) {
                console.log(' the index=' + index)
                this.currentPage = index;
                this.data2 = [].concat(this.data1.slice((index - 1) * this.pageSize, index * this.pageSize));
            },
            show(index) {
                this.empInfo = Object.assign(this.empInfo, this.data2[index]);
                this.empModal = true;
                this.createOrEditor=true;
                this.empInfo = Object.assign(this.empInfo, {index: index});
            },
            create() {
                this.empInfo=[];
                this.empModal=true;
                this.createOrEditor=false;
            },
            remove(index) {
                this.data1.splice((this.currentPage - 1) * 10 + index, 1)
            },
            changePageSize(index) {
                this.$Message.info({
                    content: '当前页面显示条数修改为： ' + index + '条/页'
                });
                this.currentPage=1;
                this.pageSize=index;
                this.changePage(this.currentPage);
            },
            okEditor() {
                if (this.createOrEditor) {
                    this.data1.splice((this.currentPage - 1) * 10 + this.empInfo.index, 1, this.empInfo)
                } else {
                    this.data1.push(Object.assign({}, this.empInfo))
                }
                this.empInfo = {}
            },
            cancelEditor() {
                this.$Message.info({
                    content: '操作取消'
                })
            }
        },

        watch: {
            showIndex(newVal) {
                if (newVal) {
                    this.tableColumns1.unshift({
                        type: 'index2',
                        width: 80,
                        align: 'center',
                        render: (h, params) => {
                            return h('span', params.index + (this.currentPage - 1) * this.pageSize + 1);
                        }
                    })
                } else {
                    this.tableColumns1.forEach((item, index) => {
                        if (item.type === 'index2') {
                            this.tableColumns1.splice(index, 1)
                        }
                    })
                }
            },
            showCheckbox(newVal) {
              if (newVal) {
                  this.tableColumns1.unshift({
                      type: 'selection',
                      width: 60,
                      align: 'center'
                  })
              }   else {
                  this.tableColumns1.forEach((item, index) => {
                      if (item.type === 'selection') {
                          this.tableColumns1.splice(index, 1)
                      }
                  })
              }
            },
            data1() {
                if (!this.createOrEditor) {
                    this.changePage(Math.ceil(this.data1.length / this.pageSize))
                } else {
                    this.changePage(this.currentPage)
                }
            }
        },
        mounted() {
            this.changePage(this.currentPage)
        }
    })
</script>
</body>
</html>